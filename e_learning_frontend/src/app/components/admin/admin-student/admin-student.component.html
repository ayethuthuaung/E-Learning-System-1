<div class="min-h-screen bg-gray-100 flex flex-col">
    <app-admin-navbar (toggleSidebarEvent)="toggleSidebar()"></app-admin-navbar>
    <div class="flex flex-1">
      <app-admin-sidebar [isSidebarOpen]="isSidebarOpen"></app-admin-sidebar>


      <main class="flex-1 p-2">
        <section class="scrollable-section">
              <div class="flex border-b">
                <button
                    class="py-2 px-4 text-md font-medium text-logo-blue hover:text-blue-800 focus:outline-none"
                    [ngClass]="{ 'border-b-2 border-blue-600': activeTab === 'attendStudent' }"
                    (click)="setActiveTab('attendStudent')"
                    >
                    Attend Student
                </button>

                <button
                  class="py-2 px-4 text-md font-medium text-logo-blue hover:text-blue-800 focus:outline-none"
                  [ngClass]="{ 'border-b-2 border-blue-600': activeTab === 'studentList' }"
                  (click)="setActiveTab('studentList')"
                >
                  Student List
                </button>

            </div>

            <div *ngIf="activeTab === 'studentList'" class="p-4">
                <app-admin-student-list></app-admin-student-list>
              </div>

                <div  *ngIf="activeTab === 'attendStudent'" class="flex-1 p-3">
                    <div class="datatable-container bg-white p-3 rounded-lg shadow-lg">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <input 
                        type="text" 
                        class="form-control w-25" 
                        placeholder="Search..." 
                        [(ngModel)]="searchTerm" 
                        (ngModelChange)="onSearchChange()" 
                        />

                        <!-- Export Courses Button -->
                        <button 
                            class="btn btn-primary ml-4"
                            (click)="exportCoursesByInstructor(userId)"
                            >
                            Excel
                        </button>
                        <button 
                            class="btn btn-primary ml-4"
                            (click)="exportCoursesByInstructorToPdf(userId)"
                            >
                            PDF
                        </button>
            
                        <div class="pagination-controls">
                        <button 
                            (click)="firstPage()" 
                            [disabled]="currentPage === 1" 
                            class="btn btn-secondary"
                        >
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button 
                            (click)="previousPage()" 
                            [disabled]="currentPage === 1" 
                            class="btn btn-secondary"
                        >
                            <i class="fas fa-angle-left"></i>
                        </button>
                        <span class="flex items-center">
                            Page 
                            <input 
                            type="number" 
                            class="page-input " 
                            [(ngModel)]="currentPage" 
                            (ngModelChange)="goToPage($event)" 
                            min="1" 
                            [max]="totalPages" 
                            /> 
                            of {{ totalPages }}
                        </span>
                        <button 
                            (click)="nextPage()" 
                            [disabled]="currentPage === totalPages" 
                            class="btn btn-secondary"
                        >
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button 
                            (click)="lastPage()" 
                            [disabled]="currentPage === totalPages" 
                            class="btn btn-secondary"
                        >
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                        </div>
                    </div>
            
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                        <thead class="thead-dark">
                            <tr>
                            <th>No</th>
                            <th>Course Name
                                <app-filter-sort-dropdown 
                                (sortChanged)="onSortChange('course.name', $event)" 
                                (filterChanged)="onFilterChange($event)"
                                ></app-filter-sort-dropdown>
                            </th>
                            <th>Student Name
                                <app-filter-sort-dropdown 
                                (sortChanged)="onSortChange('user.name', $event)" 
                                (filterChanged)="onFilterChange($event)"
                                ></app-filter-sort-dropdown>
                            </th>
                            <th>Dept
                                <app-filter-sort-dropdown 
                                (sortChanged)="onSortChange('user.department', $event)" 
                                (filterChanged)="onFilterChange($event)"
                                ></app-filter-sort-dropdown>
                            </th>
                            <th>Team
                                <app-filter-sort-dropdown 
                                (sortChanged)="onSortChange('user.team', $event)" 
                                (filterChanged)="onFilterChange($event)"
                                ></app-filter-sort-dropdown>
                            </th>
                            <th>Email
                                <app-filter-sort-dropdown 
                                (sortChanged)="onSortChange('user.email', $event)" 
                                (filterChanged)="onFilterChange($event)"
                                ></app-filter-sort-dropdown>
                            </th>
                            <th>
                                Created Date
                                <app-filter-sort-dropdown (sortChanged)="onSortChange('createdAt', $event)"
                                  (filterChanged)="onFilterChange($event)">
                                </app-filter-sort-dropdown>
                              </th>
                            <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let userCourse of paginatedUserCourses; let i = index">
                            <td class="center-cell table-cell-height">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                            <td class="table-cell-height">{{ userCourse.course?.name }}</td>
                            <td class="table-cell-height">{{ userCourse.user?.name }}</td>
                            <td class="table-cell-height">{{ userCourse.user?.department }}</td>
                            <td class="table-cell-height">{{ userCourse.user?.team }}</td>
                            <td class="table-cell-height">{{ userCourse.user?.email }}</td>
                            <td class="table-cell-height">{{ userCourse.createdAt | date: 'short' }}</td>
                            <td class="table-cell-height">


                                <div class="icon-container status-cell">
                                    <i *ngIf="userCourse.status === 'Accept'" class="fa-solid fa-circle-check" style="color: green; font-size: 24px;"></i>
                                    <i *ngIf="userCourse.status === 'Reject'" class="fa-solid fa-circle-xmark" style="color: red; font-size: 24px;"></i>
                      
                      
                                    <div *ngIf="userCourse.status === 'Pending'" class="d-flex justify-content-around status-buttons">
                                      <button class="accept-button" (click)="acceptStudent(userCourse)">
                                        <i class="fa-regular fa-circle-check icon-green"></i>
                                      </button>
                                      <button class="reject-button" (click)="rejectStudent(userCourse)">
                                        <i class="fa-regular fa-circle-xmark icon-red"></i>
                                      </button>
                                    </div>
                                    
                                  </div>
                                </td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                    </div>
                </div>
    
            </section>
        </main>
    </div>
  </div>
  