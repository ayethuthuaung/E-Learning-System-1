<div class="min-h-screen bg-gray-100 flex flex-col">
  <app-instructor-navbar (toggleSidebarEvent)="toggleSidebar()"></app-instructor-navbar>
  <div class="flex flex-1">
    <app-instructor-sidebar [isSidebarOpen]="isSidebarOpen"></app-instructor-sidebar>

    <main class="flex-1 p-6 max-h-[80vh] overflow-y-auto pr-4">
      <section>
        <div class="flex border-b">
          <button (click)="goBack()" class="py-2 px-4 text-sm font-medium text-logo-blue hover:text-blue-800 focus:outline-none flex items-center">
            <i class="fas fa-arrow-left mr-2"></i> Go Back
          </button>
          <button
            class="py-2 px-4 text-md font-medium text-logo-blue hover:text-blue-800 focus:outline-none"
            [ngClass]="{ 'border-b-2 border-blue-600': activeTab === 'createModule' }"
            (click)="setActiveTab('createModule')"
          >
            Add Module
          </button>
          <button
            class="py-2 px-4 text-md font-medium text-logo-blue hover:text-blue-800 focus:outline-none"
            [ngClass]="{ 'border-b-2 border-blue-600': activeTab === 'createExam' }"
            (click)="setActiveTab('createExam')"
          >
            Add Exam
          </button>
        </div>

        <div *ngIf="activeTab === 'createModule'" class="p-4">
          <div class="flex flex-col items-center justify-center light">
            <div class="w-full max-w-md bg-white rounded-lg shadow-md p-6">
              <form class="flex flex-col" #lessonForm="ngForm" (ngSubmit)="onSubmit(lessonForm)" method="post">
                <div *ngFor="let module of modules; let i = index" class="mb-4">
                  <div class="flex items-center mb-2">
                    <input
                      type="text"
                      class="bg-gray-100 text-gray-800 border-0 rounded-md p-2 focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500 transition ease-in-out duration-150 flex-grow"
                      [(ngModel)]="module.name"
                      name="moduleName{{ i }}"
                      required
                      placeholder="Module Name"
                    />
                    <button
                      type="button"
                      class="ml-2 text-gray-500 hover:text-red-600 transition ease-in-out duration-150"
                      (click)="removeModule(i)"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                  <input
                    type="file"
                    class="bg-gray-100 text-gray-800 border-0 rounded-md p-2 focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500 transition ease-in-out duration-150 w-full"
                    (change)="onFileSelected($event, i)"
                    name="moduleUrl{{ i }}"
                    required
                  />
                </div>

                <div class="flex space-x-2">
                  <button
                    type="button"
                    class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
                    (click)="addModule()"
                  >
                    Add Module
                  </button>
                  <button
                    type="submit"
                    class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
                  >
                    Submit
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div *ngIf="activeTab === 'createExam'" class="p-4 bg-gray-100 min-h-screen flex flex-col items-center">
          <div class="w-full max-w-xl bg-white rounded-lg shadow-md p-6">
            <input type="text" [(ngModel)]="examTitle" placeholder="Exam Title" class="bg-gray-100 form-input w-full mb-4 px-4 py-2 border rounded focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500">
            <textarea [(ngModel)]="examDescription" placeholder="Exam Description" class="bg-gray-100 form-textarea w-full mb-4 px-4 py-2 border rounded focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
            <div class="timer">
              <app-timer (durationChange)="onDurationChange($event)"></app-timer>
            </div>
            <!-- <input type="text" [(ngModel)]="examDuration" placeholder="Exam Duration" class="bg-gray-100 form-input w-full mb-4 px-4 py-2 border rounded focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500"> -->
          
            <hr class="border-blue-800 mb-4">
            <div *ngFor="let question of questions; let qIndex = index" class="mb-6">
              <hr *ngIf="qIndex > 0" class="border-blue-800 mb-4">
              <div class="relative">
                <div class="relative w-full mb-2">
                  <input 
                    type="text" 
                    [(ngModel)]="question.text" 
                    placeholder="Question" 
                    class="appearance-none bg-gray-100 w-full py-2 px-4 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none pr-10"
                  >
                  <button 
                    (click)="deleteNewQuestion(qIndex)" 
                    class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-600 transition ease-in-out duration-150"
                  >
                    <i class="fas fa-times fa-lg"></i>
                  </button>
                </div>
              </div>
              <div class="flex items-center mb-2">
                <select [(ngModel)]="question.type" class="appearance-none bg-gray-100 w-1/3 mb-2 px-4 py-2 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none">
                  <option value="multiple-choice">Multiple Choice</option>
                  <option value="checkbox">Checkbox</option>
                </select>
                <input type="text" [(ngModel)]="question.marks" placeholder="Marks" class="appearance-none bg-gray-100 w-1/3 mb-2 ml-4 px-4 py-2 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none">
              </div>
              <div class="mb-4">
                <div *ngFor="let option of question.options; let oIndex = index" class="flex items-center mb-2">
                  <input *ngIf="question.type === 'multiple-choice'" type="radio" [id]="'q' + qIndex + 'o' + oIndex" [name]="'question' + qIndex" [checked]="option.isAnswered" (change)="selectOption(qIndex, oIndex)" class="mr-2">
                  <input *ngIf="question.type === 'checkbox'" type="checkbox" [id]="'q' + qIndex + 'o' + oIndex" [(ngModel)]="option.isAnswered" class="mr-2">
                  <div *ngIf="showResults" class="ml-2">
                    <span *ngIf="option.isCorrect" class="text-green-500">Correct</span>
                    <span *ngIf="!option.isCorrect && option.isAnswered" class="text-red-500">
                      Incorrect - Correct answer: {{ question.correctAnswer }}
                    </span>
                  </div>
                  <div class="relative w-2/3">
                    <input type="text" [(ngModel)]="option.label" (click)="handleOptionClick(qIndex, oIndex)" placeholder="Option Label" class="appearance-none bg-gray-100 w-full mb-2 px-4 py-2 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none pr-10">
                    <button (click)="deleteOption(qIndex, oIndex)" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-600 transition ease-in-out duration-150">
                      <i class="fas fa-times fa-lg"></i>
                    </button>
                
              
                  </div>
                </div>
              </div>
            </div>
            <!-- <button (click)="addQuestion()" class="bg-logo-blue text-white font-bold x-4 py-2 rounded mb-2">Add Question</button> -->
            <!-- <button (click)="onSubmitExam(examForm)" class="bg-logo-blue text-white px-4 py-2 rounded ml-4 focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500">Submit Form</button> -->
            <button
                    (click)="addQuestion()"
                    class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 ml-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
                  >
                    Add Question
            </button>
            <button
                    (click)="onSubmitExam(examForm)"
                    class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 ml-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
                  >
                    Submit Form
            </button>
          </div>
        </div>
        
      </section>
    </main>
  </div>
</div>
