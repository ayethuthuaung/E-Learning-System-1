<div class="min-h-screen bg-gray-100 flex flex-col" >
  <app-instructor-navbar (toggleSidebarEvent)="toggleSidebar()"></app-instructor-navbar>
  <div class="flex flex-1">
    <app-instructor-sidebar [isSidebarOpen]="isSidebarOpen"></app-instructor-sidebar>

    <main class="flex-1 p-6 max-h-[80vh] overflow-y-auto pr-4">
      <section id="moduleExamTop">
        <div class="flex border-b">
          <button (click)="goBack()" class="py-2 px-4 text-sm font-medium text-logo-blue hover:text-blue-800 focus:outline-none flex items-center">
            <i class="fas fa-arrow-left mr-2"></i> Go Back
          </button>
          <button
            class="py-2 px-4 text-md font-medium text-logo-blue hover:text-blue-800 focus:outline-none"
            [ngClass]="{ 'border-b-2 border-blue-600': activeTab === 'createModule' }"
            (click)="setActiveTab('createModule')"
          >
            Add Module
          </button>
          <button
            class="py-2 px-4 text-md font-medium text-logo-blue hover:text-blue-800 focus:outline-none"
            [ngClass]="{ 'border-b-2 border-blue-600': activeTab === 'createExam' }"
            (click)="setActiveTab('createExam')"
          >
            Add Exam
          </button>
        </div>

        <!-- Module -->
        <div *ngIf="activeTab === 'createModule'" class="p-4">
          <h1 class="text-center w-full text-xl text-logo-blue font-bold mb-4">
            {{course?.name}} ({{course?.level}})
          </h1>          
          <div class="flex flex-wrap w-full">
            <div class="w-full lg:w-1/2 p-2"> 
              <div class="bg-white rounded-lg shadow-md p-6">
                <form class="flex flex-col" #moduleForm="ngForm" (ngSubmit)="onSubmit(moduleForm)" method="post">
                  <div *ngFor="let module of modules; let i = index" class="mb-4">
                    
                    <div *ngIf="moduleForm.submitted && !module.name" class="text-red-500 mb-2">
                      Please fill the field.
                    </div><div class="flex items-center mb-2">
                      
                      <input
                        type="text"
                        class="bg-gray-100 text-gray-800 border-0 rounded-md p-2 focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500 transition ease-in-out duration-150 flex-grow"
                        [(ngModel)]="module.name"
                        name="moduleName{{ i }}"
                        required
                        placeholder="Module Name"
                      />
                      <button
                        type="button"
                        class="ml-2 text-gray-500 hover:text-red-600 transition ease-in-out duration-150"
                        (click)="removeModule(i)"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                    <div *ngIf="moduleForm.submitted && !module.url" class="text-red-500 mb-2">
                      Please fill the field.
                    </div>
                    <input
                      type="file"
                      class="bg-gray-100 text-gray-800 border-0 rounded-md p-2 focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500 transition ease-in-out duration-150 w-full"
                      (change)="onFileSelected($event, i)"
                      name="moduleUrl{{ i }}"
                      required
                    />
                  </div>
                  
          
                  <div class="flex space-x-2">
                    <button
                    *ngIf="!isEditing"
                      type="button"
                      class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
                      (click)="addModule()"
                    >
                      Add Module
                    </button>
                    <button
              *ngIf="isEditing"
              type="submit"
              class="bg-green-500 text-white font-bold py-2 px-4 rounded-md mt-4 hover:bg-green-700 transition ease-in-out duration-150"
            >
              Save Changes
            </button>
            <button
              *ngIf="!isEditing"
              type="submit"
              class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
            >
              Submit
            </button>
                  </div>
                </form>
                <div *ngIf="loading" class="loading-overlay">
                  <!-- <div class="spinner"></div> -->
                  <div class="container">
                    <div class="dot dot-1"></div>
                    <div class="dot dot-2"></div>
                    <div class="dot dot-3"></div>
                  </div>
                  
                  <svg version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <filter id="goo">
                        <feGaussianBlur
                          result="blur"
                          stdDeviation="10"
                          in="SourceGraphic"
                        ></feGaussianBlur>
                        <feColorMatrix
                          values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 21 -7"
                          mode="matrix"
                          in="blur"
                        ></feColorMatrix>
                      </filter>
                    </defs>
                  </svg>
                  
                </div>
              </div>
            </div>
          
            <!-- Modules List -->
            <div class="w-full lg:w-7/12 xl:w-6/12 p-2">
              <ul class="space-y-4 ">
                <li *ngFor="let module of moduleList; let i = index" class="group">
                  <div 
                    class="w-full flex justify-between items-center p-3 rounded-lg border border-dark-blue text-logo-blue bg-white font-bold relative">
                    <span (click)="goToCourseDetails()" class="text-logo-blue font-bold cursor-pointer">{{ i + 1 }}. {{ module.name }}</span>
                    <div class="flex space-x-2">
                      <button (click)="editModule(i)" class="flex justify-center items-center w-8 h-8 rounded-full bg-green-100 hover:bg-green-300 text-green-800" >
                        <i class="fa-solid fa-edit"></i>
                      </button>
                      <button (click)="deleteModule(module.id)" class="flex justify-center items-center w-8 h-8 rounded-full bg-red-100 hover:bg-red-300 text-red-800">
                        <i class="fa-solid fa-trash"></i>
                      </button>
                     
                    </div>
                  </div>
                </li>
                </ul>
                </div>
          </div>
        </div>
          
       
        <!-- Exam -->
        <div *ngIf="activeTab === 'createExam'" class="p-4 bg-gray-100 min-h-screen flex flex-col items-center">
          <h1 class="text-center w-full text-xl text-logo-blue font-bold mb-4">
            {{course?.name}} ({{course?.level}})
          </h1>          
          <div class="flex flex-wrap w-full">
            <div class="w-full lg:w-1/2 p-2">
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                  <label class="block text-sm font-medium text-gray-700 mr-2 w-1/4">Title</label>
                  <input 
                    type="text" 
                    [(ngModel)]="examTitle" 
                    placeholder="Exam Title" 
                    class="bg-gray-100 form-input w-3/4 px-4 py-2 border rounded focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500"
                  >
                </div>
                <div class="flex items-center mb-4">
                  <label class="block text-sm font-medium text-gray-700 mr-2 w-1/4">Description</label>
                  <textarea 
                    [(ngModel)]="examDescription" 
                    placeholder="Exam Description" 
                    class="bg-gray-100 form-textarea w-3/4 px-4 py-2 border rounded focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500"
                  ></textarea>
                </div>
                <div class="flex items-center mb-4">
                  <label class="block text-sm font-medium text-gray-700 mr-6 w-1/4">Duration</label>
                    <app-timer (durationChange)="onDurationChange($event)"></app-timer>
                    <!-- <app-timer (durationChange)="handleDurationChange($event)"></app-timer> -->

                </div>
               
                <div class="flex items-center mb-4">
                  <label class="block mb-2 text-sm font-medium text-gray-700 w-2/6">Final exam</label>
                  <div class="flex items-center space-x-4">
                    <div class="flex items-center mr-4">
                      <input 
                        type="radio" 
                        id="finalYes" 
                        name="examFinal" 
                        [(ngModel)]="examFinal" 
                        [value]="true" 
                        class="form-radio text-blue-600 border-gray-300 focus:ring-blue-500 mr-1"
                      >
                      <label for="finalYes" class="text-gray-700">Yes</label>
                    </div>
                    <div class="flex items-center mr-4">
                      <input 
                        type="radio" 
                        id="finalNo" 
                        name="examFinal" 
                        [(ngModel)]="examFinal" 
                        [value]="false" 
                        class="form-radio text-blue-600 border-gray-300 focus:ring-blue-500 mr-1"
                      >
                      <label for="finalNo" class="text-gray-700">No</label>
                    </div>
                  </div>
                </div>
                
                <div class="flex items-center mb-4" *ngIf="examFinal">
                  <label class="block text-sm font-medium text-gray-700 mr-2 w-1/4">Pass Score</label>
                  <input 
                    type="number" 
                    [(ngModel)]="examPassScore" 
                    placeholder="Exam Pass Score" 
                    class="bg-gray-100 form-input w-3/4 px-4 py-2 border rounded focus:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500"
                  >
                </div>
                
          
            <hr class="border-4 border-logo-blue mb-4">
            <div *ngFor="let question of questions; let qIndex = index" class="mb-6">
              <hr *ngIf="qIndex > 0" class="border-blue-800 mb-4">
              <div class="relative">
                <div class="relative w-full mb-2">
                  <input 
                    type="text" 
                    [(ngModel)]="question.text" 
                    placeholder="Question" 
                    class="appearance-none bg-gray-100 w-full py-2 px-4 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none pr-10"
                  >
                  <button 
                    (click)="deleteNewQuestion(qIndex)" 
                    class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-600 transition ease-in-out duration-150"
                  >
                    <i class="fas fa-times fa-lg"></i>
                  </button>
                </div>
              </div>
              <div class="flex items-center mb-2">
                <select [(ngModel)]="question.type" class="appearance-none bg-gray-100 w-1/3 mb-2 px-4 py-2 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none">
                  <option value="multiple-choice">Multiple Choice</option>
                  <option value="checkbox">Checkbox</option>
                </select>
                <input type="text" [(ngModel)]="question.marks" placeholder="Marks" class="appearance-none bg-gray-100 w-1/3 mb-2 ml-4 px-4 py-2 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none">
              </div>
              <div class="mb-4">
                <div *ngFor="let option of question.options; let oIndex = index" class="flex items-center mb-2">
                  <input *ngIf="question.type === 'multiple-choice'" type="radio" [id]="'q' + qIndex + 'o' + oIndex" [name]="'question' + qIndex" [checked]="option.isAnswered" (change)="selectOption(qIndex, oIndex)" class="mr-2">
                  <input *ngIf="question.type === 'checkbox'" type="checkbox" [id]="'q' + qIndex + 'o' + oIndex" [(ngModel)]="option.isAnswered" class="mr-2">
                  <div *ngIf="showResults" class="ml-2">
                    <span *ngIf="option.isCorrect" class="text-green-500">Correct</span>
                    <span *ngIf="!option.isCorrect && option.isAnswered" class="text-red-500">
                      Incorrect - Correct answer: {{ question.correctAnswer }}
                    </span>
                  </div>
                  <div class="relative w-2/3">
                    <input type="text" [(ngModel)]="option.label" (click)="handleOptionClick(qIndex, oIndex)" placeholder="Option Label" class="appearance-none bg-gray-100 w-full mb-2 px-4 py-2 border-b-2 border-gray-400 focus:border-blue-500 focus:outline-none pr-10">
                    <button (click)="deleteOption(qIndex, oIndex)" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-600 transition ease-in-out duration-150">
                      <i class="fas fa-times fa-lg"></i>
                    </button>
                
              
                  </div>
                </div>
              </div>
            </div>
             <button
                    (click)="addQuestion()"
                    class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 ml-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
                  >
                    Add Question
            </button>
            <button
                    (click)="onSubmitExam(examForm)"
                    class="bg-logo-blue from-dark-blue to-logo-blue text-white font-bold py-2 px-4 ml-4 rounded-md mt-4 hover:bg-dark-blue hover:to-logo-blue transition ease-in-out duration-150"
                  >
                    Submit Form
            </button>
          </div>
        </div>

        <!-- Exam List -->
        <div class="w-full lg:w-7/12 xl:w-6/12 p-2">
          <ul class="space-y-4 ">
            <li *ngFor="let exam of examList; let i = index" class="group">
              <div 
                class="w-full flex justify-between items-center p-3 rounded-lg border border-dark-blue text-logo-blue bg-white font-bold relative">
                <span (click)="viewQuestionFormClick(exam.id)" class="text-logo-blue font-bold">
                  {{ i + 1 }}. {{ exam.title }} 
                  <span *ngIf="exam.finalExam">(Final Exam)</span>
                </span>                <div class="flex space-x-2">
                  <!-- <button class="flex justify-center items-center w-8 h-8 rounded-full bg-green-100 hover:bg-green-300 text-green-800" >
                    <i class="fa-solid fa-edit"></i>
                  </button> -->
                  <button (click)="deleteExam(exam.id)" class="flex justify-center items-center w-8 h-8 rounded-full bg-red-100 hover:bg-red-300 text-red-800">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                 
                </div>
              </div>
            </li>
            </ul>
            </div>
        </div>
        </div>
        
      </section>
    </main>
  </div>
</div>
